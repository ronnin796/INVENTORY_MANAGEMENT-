{% extends "core/base.html" %}
{% block title %}Product Alert Status{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-6">Restocking Status</h2>

  <!-- Filter Form -->
  <form method="get" class="mb-6 flex flex-col sm:flex-row sm:items-center gap-4">
    <div class="flex-1">
      <label for="status_filter" class="block mb-2 font-medium">Filter by Status:</label>
      <select name="status" id="status_filter" class="w-full p-2 border rounded shadow-sm">
        <option value="">All</option>
        <option value="alert" {% if selected_status == 'alert' %}selected{% endif %}>Needs Restocking</option>
        <option value="ok" {% if selected_status == 'ok' %}selected{% endif %}>Sufficient Stock</option>
      </select>
    </div>
    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Apply Filter</button>
  </form>

  <!-- Products Table -->
  <div class="overflow-x-auto border rounded-lg shadow-sm">
    <table class="w-full table-auto border-collapse">
      <thead class="bg-gray-100 text-left">
        <tr>
          <th class="p-3 border-b">Product</th>
          <th class="p-3 border-b">Category</th>
          <th class="p-3 border-b">Subcategory</th>
          <th class="p-3 border-b">Current Stock</th>
          <th class="p-3 border-b">Threshold</th>
          <th class="p-3 border-b">Predicted Stock</th>
          <th class="p-3 border-b">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for product in filtered_products %}
        <tr class="text-center {% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 border">{{ product.name }}</td>
          <td class="p-2 border">{{ product.category.name }}</td>
          <td class="p-2 border">{{ product.sub_category.name }}</td>
          <td class="p-2 border">{{ product.current_stock }}</td>
          <td class="p-2 border">{{ product.reorder_threshold }}</td>
          <td class="p-2 border">{{ product.predicted_stock|floatformat:2 }}</td>
          <td class="p-2 border">
            {% if product.predicted_stock <= product.reorder_threshold %}
              <span class="text-red-600 font-semibold">⚠ Needs Restocking</span>
            {% else %}
              <span class="text-green-600 font-semibold">✔ Sufficient</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="p-4 text-gray-500 text-center">No products found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
